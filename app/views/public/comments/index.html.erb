<%= render "public/header2" %>
<div class="container mt-4">

  <h2 class="mb-3 border-bottom pb-2">コメント</h2>

  <% if @comments.any? %>
    <% @comments.each do |comment| %>
      <div id="comment-<%= comment.id %>" class="media mb-4 p-3 border rounded shadow-sm bg-light">
        <!-- ユーザー画像（あれば） -->
        <% if comment.user.profile_image.attached? %>
          <%= image_tag comment.user.get_profile_image, size: "50x50", class: "mr-3 rounded-circle border" %>
        <% else %>
          <%= image_tag "no_image.jpg", size: "50x50", class: "mr-3 rounded-circle border" %>
        <% end %>

        <div class="media-body">
          <div class="d-flex justify-content-between align-items-center">
            <strong>
              <%= link_to comment.user.username, public_user_path(comment.user), class: "text-dark" %>
            </strong>

            <!-- 削除ボタン（本人のみ表示） -->
            <% if comment.user == current_user %>
              <%= link_to "削除",
                          public_post_comment_path(@post, comment),
                          method: :delete,
                          data: { confirm: "削除しますか？" },
                          class: "btn btn-sm btn-outline-danger" %>
            <% end %>
          </div>

          <!-- コメント本文 -->
          <p class="mb-2 mt-2"><%= simple_format(comment.body) %></p>

          <!-- いいねボタン -->
          <div>
            <%= render 'public/comments/comment_like', comment: comment %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="text-muted">まだコメントはありません。</p>
  <% end %>

  <div class="fixed-comment-form bg-white border-top py-2 w-100 comment-fixed">
    <div class="container">
      <%= form_with model: [@post, Comment.new],
                    url: public_post_comments_path(@post),
                    local: true do |f| %>
        <div class="form-row align-items-center">
          <h4 class="mt-4 mb-3">新しいコメントを投稿</h4>
          <div class="col-9 col-md-10">
            <%= f.text_area :body,
                            rows: 2,
                            placeholder: "コメントを入力してください...",
                            class: "form-control" %>
          </div>
          <div class="col-3 col-md-2 text-right">
            <%= f.submit "送信", class: "btn btn-primary btn-block" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
