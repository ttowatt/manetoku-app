<%= render "public/header2" %>
<div class="container mt-4">
  <h1 class="mb-3">検索結果</h1>

  <% if @keyword.present? %>
    <p>検索ワード：「<strong><%= @keyword %></strong>」</p>
  <% else %>
    <p>検索ワードが入力されていません。</p>
  <% end %>

  <% if @results.present? && @results.any? %>
    <% if @model == "user" %>
      <h3>ユーザー一覧 (<%= @results.count %>件)</h3>
      <div class="user-results mt-3">
        <% @results.each do |user| %>
          <div class="card mb-3 p-3 shadow-sm">
            <div class="d-flex align-items-center">
              <%= image_tag user.get_profile_image, size: "60x60", class: "rounded-circle me-3" %>
              <div>
                <h5><%= link_to user.username, public_user_path(user), class: "text-dark fw-bold" %></h5>
                <p class="mb-0 text-muted"><%= truncate(user.introduction, length: 30) %></p>
              </div>
            </div>
          </div>
        <% end %>
      </div>

    <% elsif @model == "post" %>
      <h3>投稿一覧 (<%= @results.count %>件)</h3>
      <div class="container py-4">
        <div class="row justify-content-center">
          <% @results.each do |post| %>
            <div class="col-12 mb-4">
              <div class="card h-100 shadow-sm">
                <%= image_tag post.get_post_image, class: "card-img-top", alt: "投稿画像" %>
                <div class="card-body text-left">
                  <p class="mb-1 btn btn-success"><%= post.category %></p>
                  <% if post.user.present? %>
                    <%= link_to post.user.username, public_user_path(post.user) %>
                  <% else %>
                    <span class="text-muted">退会したユーザー</span>
                  <% end %>
                  <h5 class="card-title mb-2"><%= post.title %></h5>
                  <p class="card-text">
                    <%= truncate(post.body, length: 11) %>
                    <%= link_to "詳細を見る", public_post_path(post), class:"btn btn-link" %>
                  </p>
                  <div class="d-flex align-items-center my-3">
            
                    <%= render 'public/posts/post_like', post: post %>

                    <% avg_star = post.reviews.average(:star) || 0 %>
                    <p class="mb-0 mr-3 d-flex align-items-center">
                      <i class="fa-solid fa-star star-color me-1"></i>
                      <%= avg_star.round(1) %> / 5 (<%= post.reviews.count %>件)
                    </p>

                    <%= link_to public_post_comments_path(post), class: "ml-3 text-secondary d-flex align-items-center" do %>
                      <i class="fa-regular fa-comment fa-2x"></i>
                    <% end %>
                  </div>
                  <% if post.user != current_user %>
                    <%= link_to "評価する", new_public_post_review_path(post), class:"btn btn-primary" %>
                    <%= link_to "評価一覧", public_post_reviews_path(post), class:"btn btn-primary" %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <p class="text-muted">該当する結果はありません。</p>
    <% end %>
  <% end %>
</div>